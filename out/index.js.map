{"version":3,"file":"index.js","sourceRoot":"","sources":["../src/index.ts"],"names":[],"mappings":"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","sourcesContent":["import chalk from 'chalk'\r\nimport { spawn } from 'child_process'\r\nimport { config as dotenv } from 'dotenv'\r\nimport { readFileSync, writeFileSync } from 'fs'\r\nimport inquirer from 'inquirer'\r\nimport path from 'path'\r\nimport { NodeSetupConfig, PackageJson } from './types'\r\n\r\ndotenv()\r\n\r\nconst appPath = path.resolve(process.cwd()).split('node_modules')[0]\r\n\r\nconst defaultConfig: NodeSetupConfig = {\r\n  packageManager: process.env.PACKAGE_MANAGER || 'npm',\r\n  envVars: [],\r\n}\r\n\r\nconst packageJsonPath = path.join(appPath, 'package.json')\r\n\r\nconst packageJson: PackageJson = JSON.parse(\r\n  readFileSync(packageJsonPath, 'utf8'),\r\n)\r\n\r\nconst config: NodeSetupConfig = {\r\n  ...defaultConfig,\r\n  ...packageJson['node-setup'],\r\n}\r\n\r\nasync function install() {\r\n  const child = spawn(config.packageManager, ['install'], {\r\n    stdio: 'inherit',\r\n    shell: true,\r\n  })\r\n\r\n  await new Promise((resolve, reject) => {\r\n    child.addListener('error', reject)\r\n    child.addListener('exit', resolve)\r\n  }).catch((error) => {\r\n    console.error(error)\r\n    process.exit(1)\r\n  })\r\n\r\n  console.log('Installed dependencies')\r\n}\r\n\r\nasync function setupEnv() {\r\n  const processEnv: Record<string, string> = {}\r\n  dotenv({ processEnv })\r\n\r\n  const envPrompt = await inquirer.prompt([\r\n    {\r\n      type: 'input',\r\n      name: 'envName',\r\n      message: 'Environment file name',\r\n      default: '.env',\r\n    },\r\n  ])\r\n\r\n  const allEnvKeys = [\r\n    ...new Set([...Object.keys(processEnv), ...config.envVars]),\r\n  ]\r\n\r\n  const dotEnvPath = path.join(appPath, envPrompt.envName)\r\n\r\n  const createEnvVarPrompt = async () =>\r\n    await inquirer.prompt([\r\n      {\r\n        type: 'list',\r\n        name: 'envVar',\r\n        message: 'Environment variables',\r\n        choices: [\r\n          ...allEnvKeys.map((envVar) => ({\r\n            name: processEnv[envVar]\r\n              ? `${envVar}: ${processEnv[envVar]}`\r\n              : envVar,\r\n            value: envVar,\r\n          })),\r\n          new inquirer.Separator(),\r\n          {\r\n            name: 'Save and exit',\r\n            value: 'save',\r\n          },\r\n          new inquirer.Separator(),\r\n        ],\r\n      },\r\n    ])\r\n\r\n  const createEditEnvVarPrompt = async (varName: string) =>\r\n    await inquirer.prompt([\r\n      {\r\n        type: 'input',\r\n        name: 'envVar',\r\n        message: `Value for ${varName}`,\r\n        default: processEnv[varName] ?? '',\r\n      },\r\n    ])\r\n\r\n  let envVarPrompt = await createEnvVarPrompt()\r\n\r\n  while (envVarPrompt.envVar !== 'save') {\r\n    const envPrompt = await createEditEnvVarPrompt(envVarPrompt.envVar)\r\n    processEnv[envVarPrompt.envVar] = envPrompt.envVar\r\n    envVarPrompt = await createEnvVarPrompt()\r\n  }\r\n\r\n  console.log(\r\n    chalk.blackBright('\\nSaving environment variables to'),\r\n    chalk.blueBright(dotEnvPath),\r\n  )\r\n\r\n  let envFile = ''\r\n\r\n  for (const [key, value] of Object.entries(processEnv)) {\r\n    envFile += `${key}=${value}\\n`\r\n  }\r\n\r\n  writeFileSync(dotEnvPath, envFile)\r\n}\r\n\r\nasync function main() {\r\n  console.log(chalk.blackBright('Installing dependencies\\n'))\r\n  await install()\r\n  console.log(chalk.blackBright('\\nSetting up environment variables\\n'))\r\n  await setupEnv()\r\n  console.log(chalk.green('\\nâœ“'), chalk.blackBright('Done'))\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-floating-promises\r\nmain()\r\n\r\nexport { NodeSetupConfig, PackageJson, defaultConfig, install, setupEnv }\r\n\r\n"]}